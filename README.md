# 图片评分与排序系统

这是一个简单的图片评分和排序系统，允许用户上传多张图片，每3张为一组进行评分，最终生成一个排序后的图片列表。

## 功能特点

- 批量上传图片
- 每次显示3张图片供用户评分（喜欢/一般/不喜欢）
- 基于用户评分自动排序图片
- 直观展示排序结果
- 美观、响应式的界面设计

## 技术栈

- 后端：Python Flask
- 数据库：SQLite
- 前端：HTML, CSS, Vue.js (通过CDN)

## 安装与运行

1. 克隆项目到本地
2. 安装依赖
```
pip install -r requirements.txt
```
3. 运行应用
```
python app.py
```
4. 打开浏览器访问 `http://localhost:5000`

## 系统流程

1. 用户批量上传图片
2. 系统每次从数据库中获取3张图片供用户评分
3. 用户对每张图片进行评分（喜欢 +1 / 一般 0 / 不喜欢 -1）
4. 系统根据用户评分结果计算每张图片的平均评分
5. 用户可以查看根据平均评分排序后的图片列表

## 锦标赛排序算法设计

系统使用基于有向图的拓扑排序算法（Tournament Sort）来对图片进行排序，这比简单的平均分排序更能反映用户的真实偏好。

### 核心原理

1. **三元比较构建有向图**：
   - 用户每次对3张图片进行评分，系统会将这3张图片根据评分高低形成一个有向关系图
   - 评分高的图片指向评分低的图片（表示"胜出"）
   - 例如：图片A评分为"喜欢"(+1)，图片B评分为"一般"(0)，图片C评分为"不喜欢"(-1)，则有A→B→C

2. **拓扑排序**：
   - 构建完整个有向图后，系统使用拓扑排序算法确定图片的最终排序
   - 入度为0的节点（没有被其他图片胜出的图片）优先排在前面
   - 随着节点被处理，相邻节点的入度减少，直到所有节点都被处理

3. **环处理机制**：
   - 当出现循环依赖关系（例如A胜B，B胜C，C胜A）时，拓扑排序无法处理
   - 系统采用备选策略：对环中的节点，根据评分次数和最近评分时间进行排序

4. **并列检测**：
   - 系统会检测相邻图片之间是否存在直接或间接的优先级关系
   - 如果不存在，则标记为并列，提示用户进行额外评分以解决并列情况

### 评分统计指标

系统在前端展示的锦标赛统计指标包括：

1. **锦标赛得分(tournament_score)**：出度减去入度，表示图片的综合优势
   - 计算公式：`out_degree - in_degree`
   - 正值表示整体表现较好，负值表示整体表现较差
   - 注意：最终排序不仅基于此分数，还受拓扑排序算法影响

2. **出度(out_degree)**：该图片胜出多少其他图片的数量

3. **入度(in_degree)**：有多少其他图片胜出该图片的数量

4. **胜率(win_rate)**：在所有参与的比较中获胜的比例

5. **比较总次数(comparison_count)**：该图片参与比较的总次数

6. **胜出次数(wins)**：该图片在所有比较中获胜的次数

7. **相对强度(relative_strength)**：该图片胜出的其他图片占总体的比例

### 排序特性说明

1. **非线性排序**：由于采用拓扑排序，可能出现tournament_score较高的图片排在较低图片后面的情况，这是因为排序主要基于有向图关系而非单一分数。

2. **增量式排序**：随着用户评分的增加，系统自动优化排序结果，解决并列情况，提高排序精确度。

3. **并列优先处理**：系统会优先展示并列的图片供用户再次评分，以便更好地确定它们之间的优先级关系。

## 注意事项

- 确保 `static/uploads` 目录存在且可写
- 数据库文件将自动创建在应用根目录下
- 所有上传的图片将保存在 `static/uploads` 目录中 